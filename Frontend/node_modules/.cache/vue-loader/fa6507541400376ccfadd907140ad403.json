{"remainingRequest":"E:\\ConstructionConsultationSystem\\Frontend\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!E:\\ConstructionConsultationSystem\\Frontend\\src\\views\\implement\\design\\Design.vue?vue&type=script&lang=js&","dependencies":[{"path":"E:\\ConstructionConsultationSystem\\Frontend\\src\\views\\implement\\design\\Design.vue","mtime":1563496268449},{"path":"E:\\ConstructionConsultationSystem\\Frontend\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"E:\\ConstructionConsultationSystem\\Frontend\\node_modules\\thread-loader\\dist\\cjs.js","mtime":499162500000},{"path":"E:\\ConstructionConsultationSystem\\Frontend\\node_modules\\babel-loader\\lib\\index.js","mtime":499162500000},{"path":"E:\\ConstructionConsultationSystem\\Frontend\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"E:\\ConstructionConsultationSystem\\Frontend\\node_modules\\vue-loader\\lib\\index.js","mtime":499162500000}],"contextDependencies":[],"result":["//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n\nimport DesignMoneyModal from './components/DesignMoneyModal'\nconst columns = [\n  {\n    title: '设计单位名称',\n    dataIndex: 'name',\n    width: '12%',\n    align: 'center'\n  },\n  {\n    title: '类别',\n    dataIndex: 'type',\n    width: '8%',\n    align: 'center'\n  },\n   {\n    title: '项目名称',\n    dataIndex: 'project_name',\n    width: '12%',\n    align: 'center'\n  },\n  {\n    title: '合同额',\n    dataIndex: 'contract_price',\n    width: '8%',\n    align: 'center'\n  },\n  {\n    title: '结算额',\n    dataIndex: 'settled_price',\n    width: '12%',\n    align: 'center'\n  },\n  {\n    title: '支付累计',\n    dataIndex: 'paid_total',\n    width: '12%',\n    align: 'center'\n  },\n  {\n    title: '本次应付',\n    dataIndex: 'should_pay',\n    width: '10%',\n    align: 'center'\n  },\n  {\n    title: '本次实付',\n    dataIndex: 'actual_pay',\n    width: '10%',\n    align: 'center'\n  },\n  {\n    title: '比例',\n    width: '10%',\n    align: 'center',\n    scopedSlots: { customRender: 'ratio' }\n  },\n  {\n    title: '编辑',\n    dataIndex: 'operation',\n    scopedSlots: { customRender: 'operation' },\n    align: 'center'\n  }\n]\nimport api from '../../../api/implement'\n\nexport default {\n  name: 'Design',\n  components: { DesignMoneyModal },\n  data () {\n    return {\n      columns,\n      designItemList: [],\n      list: [],\n      current: 0,\n      doing_id: null,\n      designCompanyList: [],\n      status: {\n        listLoading: true,\n        tableLoading: true\n      },\n      moneys:{},\n      modal: {\n        record: null,\n        visible: false,\n        type: '1',\n        money_id: this.company_id\n      },\n    }\n  },\n  mounted () {\n    this.getData()\n  },\n  methods: {\n    getData () {\n      this.getDesignItemList()\n      this.getDesignCompanyList()\n    },\n    getDesignItemList () {\n      this.status.listLoading = true\n      api.getDesignItemList(this.project_id)\n        .then(data => {\n          this.designItemList = data.slice(0, 12)\n          this.list[0] = data[12]\n          this.list[1] = data[8]\n          this.list[2] = data[13]\n          this.getDesignItemDoing()\n          this.status.listLoading = false\n        })\n    },\n    getDesignItemDoing () {\n      api.getDesignItemDoing(this.project_id)\n        .then(data => {\n          this.current = data[0].design_item - this.designItemList[0].design_item_id\n          this.doing_id = data[0].id\n        })\n    },\n    getDesignCompanyList () {\n      this.status.tableLoading = true\n      api.getDesignCompanyList(this.project_id)\n        .then(data => {\n          this.designCompanyList = data\n          this.status.tableLoading = false\n        })\n    },\n    handleChangeCurrent (item) {\n      this.current = item.design_item_id - this.designItemList[0].design_item_id\n      api.updateDesignItemDoing(this.doing_id, item.design_item_id)\n        .then(data => {\n          this.$notification.success({ message: '成功', description: '更换正在进行项目成功', key: 'SUCCESS' })\n        })\n    },\n    getIconType (item) {\n      let ret = ''\n      if (item.design_item_id - this.designItemList[0].design_item_id < this.current) {\n        ret = 'check-circle'\n      } else if (item.design_item_id - this.designItemList[0].design_item_id === this.current) {\n        ret = 'clock-circle'\n      } else {\n        ret = 'minus-circle'\n      }\n      return ret\n    },\n    handleClose () {\n      this.modal.type = ''\n      this.modal.record = null\n      this.modal.visible = false\n      this.getDesignCompanyList()\n    },\n    handleCreate () {\n      this.modal.type = 'create'\n      this.modal.record = null\n      this.modal.visible = true\n    },\n    handleEdit (record) {\n      this.modal.type = 'edit'\n      this.modal.record = record\n      this.modal.visible = true\n    },\n    handleDelete (record) {\n      api.deleteDesignCompany(record.company_id)\n        .then(data => {\n          this.$notification.success({ message: '成功', description: '删除成功', key: 'SUCCESS' })\n          this.getDesignCompanyList()\n        })\n    },\n    getRatio (record) {\n      let paid_total = parseFloat(record.paid_total)\n      let settled_price = parseFloat(record.settled_price)\n      if (paid_total && settled_price) {\n        return `${((paid_total / settled_price) * 100).toFixed(2)} %`\n      } else {\n        return ''\n      }\n    }\n  },\n  computed: {\n    project_id () {\n      return this.$store.getters.projectSelected.id\n    }\n  }\n}\n",{"version":3,"sources":["Design.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AA4FA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"Design.vue","sourceRoot":"src/views/implement/design","sourcesContent":["<template>\r\n  <div>\r\n    <a-card style=\"margin-bottom: 16px\">\r\n      <a-spin :spinning=\"status.listLoading\">\r\n        <a-steps size=\"small\" :current=\"current\">\r\n          <a-step\r\n            v-for=\"item in designItemList\"\r\n            :key=\"item.design_item_id\">\r\n            <template slot=\"title\">\r\n              <router-link :to=\"{'name': 'implementDesignDetail', params: {id: item.design_item_id}}\">{{item.name}}\r\n              </router-link>\r\n            </template>\r\n            <template slot=\"icon\">\r\n              <a-popconfirm title=\"设置为正在进行\" @confirm=\"handleChangeCurrent(item)\">\r\n                <a-icon\r\n                  :type=\"getIconType(item)\"\r\n                  :theme=\"item.design_item_id - designItemList[0].design_item_id === current ? 'filled' : 'outlined'\"\r\n                  style=\"cursor: pointer\"></a-icon>\r\n              </a-popconfirm>\r\n            </template>\r\n          </a-step>\r\n        </a-steps>\r\n      </a-spin>\r\n    </a-card>\r\n    <a-card style=\"margin-bottom: 16px\">\r\n      <a-spin :spinning=\"status.listLoading\">\r\n        <a-row :gutter=\"16\">\r\n          <a-col\r\n            v-for=\"item in list\"\r\n            :key=\"item.id\"\r\n            :xs=\"{ span: 24 }\"\r\n            :sm=\"{ span: 8 }\"\r\n            :xl=\"{ span: 8 }\">\r\n            <a-card\r\n              class=\"card\"\r\n              @click=\"$router.push({'name': 'implementDesignDetail', params: {id: item.design_item_id}})\">\r\n              {{item.name}}\r\n            </a-card>\r\n          </a-col>\r\n        </a-row>\r\n      </a-spin>\r\n    </a-card>\r\n    <div>\r\n       <design-money-modal\r\n      :record=\"modal.record\"\r\n      :visible=\"modal.visible\"\r\n      :type=\"modal.type\"\r\n      :money_id=\"modal.money_id\"\r\n      v-if=\"modal.visible\"\r\n      @close=\"handleClose()\">\r\n    </design-money-modal>\r\n      <a-card>\r\n      <a-row class=\"item\">\r\n        <a-col\r\n          :xs=\"{ span: 24 }\"\r\n          :sm=\"{ span: 12, offset: 12 }\"\r\n          :xl=\"{ span: 4, offset: 20 }\">\r\n          <a-button\r\n            type=\"primary\"\r\n            icon=\"plus\"\r\n            style=\"width: 100%\"\r\n            @click=\"handleCreate()\" >\r\n            新建\r\n          </a-button>\r\n        </a-col>\r\n      </a-row>\r\n      <a-table\r\n        bordered\r\n        :columns=\"columns\"\r\n        :dataSource=\"designCompanyList\"\r\n        rowKey=\"company_id\"\r\n        :loading=\"status.tableLoading\"\r\n        :pagination=\"false\">\r\n        <template slot=\"ratio\" slot-scope=\"text, record, index\">\r\n          {{getRatio(record)}}\r\n        </template>\r\n        <template slot=\"operation\" slot-scope=\"text, record, index\">\r\n          <a-button @click=\"handleEdit(record)\">编辑</a-button>\r\n          <a-popconfirm\r\n            title=\"确认删除吗?\"\r\n            @confirm=\"handleDelete(record)\">\r\n            <a-button type=\"danger\">删除</a-button>\r\n          </a-popconfirm>\r\n        </template>\r\n      </a-table>\r\n    </a-card>\r\n    </div>\r\n\r\n  </div>\r\n</template>\r\n\r\n<script>\r\n  import DesignMoneyModal from './components/DesignMoneyModal'\r\n  const columns = [\r\n    {\r\n      title: '设计单位名称',\r\n      dataIndex: 'name',\r\n      width: '12%',\r\n      align: 'center'\r\n    },\r\n    {\r\n      title: '类别',\r\n      dataIndex: 'type',\r\n      width: '8%',\r\n      align: 'center'\r\n    },\r\n     {\r\n      title: '项目名称',\r\n      dataIndex: 'project_name',\r\n      width: '12%',\r\n      align: 'center'\r\n    },\r\n    {\r\n      title: '合同额',\r\n      dataIndex: 'contract_price',\r\n      width: '8%',\r\n      align: 'center'\r\n    },\r\n    {\r\n      title: '结算额',\r\n      dataIndex: 'settled_price',\r\n      width: '12%',\r\n      align: 'center'\r\n    },\r\n    {\r\n      title: '支付累计',\r\n      dataIndex: 'paid_total',\r\n      width: '12%',\r\n      align: 'center'\r\n    },\r\n    {\r\n      title: '本次应付',\r\n      dataIndex: 'should_pay',\r\n      width: '10%',\r\n      align: 'center'\r\n    },\r\n    {\r\n      title: '本次实付',\r\n      dataIndex: 'actual_pay',\r\n      width: '10%',\r\n      align: 'center'\r\n    },\r\n    {\r\n      title: '比例',\r\n      width: '10%',\r\n      align: 'center',\r\n      scopedSlots: { customRender: 'ratio' }\r\n    },\r\n    {\r\n      title: '编辑',\r\n      dataIndex: 'operation',\r\n      scopedSlots: { customRender: 'operation' },\r\n      align: 'center'\r\n    }\r\n  ]\r\n  import api from '../../../api/implement'\r\n\r\n  export default {\r\n    name: 'Design',\r\n    components: { DesignMoneyModal },\r\n    data () {\r\n      return {\r\n        columns,\r\n        designItemList: [],\r\n        list: [],\r\n        current: 0,\r\n        doing_id: null,\r\n        designCompanyList: [],\r\n        status: {\r\n          listLoading: true,\r\n          tableLoading: true\r\n        },\r\n        moneys:{},\r\n        modal: {\r\n          record: null,\r\n          visible: false,\r\n          type: '1',\r\n          money_id: this.company_id\r\n        },\r\n      }\r\n    },\r\n    mounted () {\r\n      this.getData()\r\n    },\r\n    methods: {\r\n      getData () {\r\n        this.getDesignItemList()\r\n        this.getDesignCompanyList()\r\n      },\r\n      getDesignItemList () {\r\n        this.status.listLoading = true\r\n        api.getDesignItemList(this.project_id)\r\n          .then(data => {\r\n            this.designItemList = data.slice(0, 12)\r\n            this.list[0] = data[12]\r\n            this.list[1] = data[8]\r\n            this.list[2] = data[13]\r\n            this.getDesignItemDoing()\r\n            this.status.listLoading = false\r\n          })\r\n      },\r\n      getDesignItemDoing () {\r\n        api.getDesignItemDoing(this.project_id)\r\n          .then(data => {\r\n            this.current = data[0].design_item - this.designItemList[0].design_item_id\r\n            this.doing_id = data[0].id\r\n          })\r\n      },\r\n      getDesignCompanyList () {\r\n        this.status.tableLoading = true\r\n        api.getDesignCompanyList(this.project_id)\r\n          .then(data => {\r\n            this.designCompanyList = data\r\n            this.status.tableLoading = false\r\n          })\r\n      },\r\n      handleChangeCurrent (item) {\r\n        this.current = item.design_item_id - this.designItemList[0].design_item_id\r\n        api.updateDesignItemDoing(this.doing_id, item.design_item_id)\r\n          .then(data => {\r\n            this.$notification.success({ message: '成功', description: '更换正在进行项目成功', key: 'SUCCESS' })\r\n          })\r\n      },\r\n      getIconType (item) {\r\n        let ret = ''\r\n        if (item.design_item_id - this.designItemList[0].design_item_id < this.current) {\r\n          ret = 'check-circle'\r\n        } else if (item.design_item_id - this.designItemList[0].design_item_id === this.current) {\r\n          ret = 'clock-circle'\r\n        } else {\r\n          ret = 'minus-circle'\r\n        }\r\n        return ret\r\n      },\r\n      handleClose () {\r\n        this.modal.type = ''\r\n        this.modal.record = null\r\n        this.modal.visible = false\r\n        this.getDesignCompanyList()\r\n      },\r\n      handleCreate () {\r\n        this.modal.type = 'create'\r\n        this.modal.record = null\r\n        this.modal.visible = true\r\n      },\r\n      handleEdit (record) {\r\n        this.modal.type = 'edit'\r\n        this.modal.record = record\r\n        this.modal.visible = true\r\n      },\r\n      handleDelete (record) {\r\n        api.deleteDesignCompany(record.company_id)\r\n          .then(data => {\r\n            this.$notification.success({ message: '成功', description: '删除成功', key: 'SUCCESS' })\r\n            this.getDesignCompanyList()\r\n          })\r\n      },\r\n      getRatio (record) {\r\n        let paid_total = parseFloat(record.paid_total)\r\n        let settled_price = parseFloat(record.settled_price)\r\n        if (paid_total && settled_price) {\r\n          return `${((paid_total / settled_price) * 100).toFixed(2)} %`\r\n        } else {\r\n          return ''\r\n        }\r\n      }\r\n    },\r\n    computed: {\r\n      project_id () {\r\n        return this.$store.getters.projectSelected.id\r\n      }\r\n    }\r\n  }\r\n</script>\r\n\r\n<style scoped lang=\"less\">\r\n  @import '../../../../public/color';\r\n\r\n  .item {\r\n    margin-bottom: 16px;\r\n  }\r\n\r\n  .ant-timeline-item-last {\r\n    height: 20px;\r\n    padding: 0;\r\n  }\r\n\r\n  .card {\r\n    text-align: center;\r\n\r\n    &:hover {\r\n      border-color: @primary-color;\r\n      box-shadow: 0 0 1px @primary-color;\r\n    }\r\n  }\r\n</style>"]}]}