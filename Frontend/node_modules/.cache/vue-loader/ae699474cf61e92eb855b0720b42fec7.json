{"remainingRequest":"E:\\ConstructionConsultationSystem\\Frontend\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!E:\\ConstructionConsultationSystem\\Frontend\\src\\views\\detail\\Contact.vue?vue&type=script&lang=js&","dependencies":[{"path":"E:\\ConstructionConsultationSystem\\Frontend\\src\\views\\detail\\Contact.vue","mtime":1572857662640},{"path":"E:\\ConstructionConsultationSystem\\Frontend\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"E:\\ConstructionConsultationSystem\\Frontend\\node_modules\\babel-loader\\lib\\index.js","mtime":499162500000},{"path":"E:\\ConstructionConsultationSystem\\Frontend\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"E:\\ConstructionConsultationSystem\\Frontend\\node_modules\\vue-loader\\lib\\index.js","mtime":499162500000}],"contextDependencies":[],"result":["//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n\r\n\r\nconst columns = [\r\n  {\r\n    title: '单位',\r\n    dataIndex: 'company',\r\n    width: '10%',\r\n    align: 'center'\r\n  },\r\n  {\r\n    title: '单位类型',\r\n    dataIndex: 'company_type.label',\r\n    width: '14%',\r\n    align: 'center'\r\n  },\r\n  {\r\n    title: '姓名',\r\n    dataIndex: 'name',\r\n    width: '8%',\r\n    align: 'center'\r\n  },\r\n  {\r\n    title: '岗位',\r\n    dataIndex: 'job',\r\n    width: '10%',\r\n    align: 'center'\r\n  },\r\n  {\r\n    title: '邮箱',\r\n    dataIndex: 'email',\r\n    width: '17%',\r\n    align: 'center'\r\n  },\r\n  {\r\n    title: '联系电话',\r\n    dataIndex: 'telephone',\r\n    width: '15%',\r\n    align: 'center'\r\n  },\r\n  {\r\n    title: '备注',\r\n    dataIndex: 'note',\r\n    width: '13%',\r\n    align: 'center'\r\n  },\r\n  {\r\n    title: '编辑',\r\n    dataIndex: 'operation',\r\n    align: 'center',\r\n    scopedSlots: { customRender: 'operation' }\r\n  }\r\n]\r\nimport api from '../../api/detail'\r\nimport ContactModal from './components/ContactModal'\r\nimport ImageModal from './components/ImageModal'\r\nimport { mapGetters } from 'vuex'\r\nimport { getCookie } from '../../utils/util'\r\n\r\nexport default {\r\n  name: 'RelatedCompany',\r\n  components: {\r\n    ContactModal,\r\n    ImageModal\r\n  },\r\n  data () {\r\n    return {\r\n      layout: {\r\n        xs: { span: 12 },\r\n        sm: { span: 6 },\r\n        xl: { span: 3 }\r\n      },\r\n      status: {\r\n        loading: true\r\n      },\r\n      project_id: this.projectSelected().id,\r\n      params: {\r\n        search: '',\r\n        page: 1,\r\n        ordering: '-company',\r\n        company_type: '',\r\n        project_id: this.projectSelected().id\r\n      },\r\n      modal: {\r\n        record: null,\r\n        visible: false,\r\n        type: '1'\r\n      },\r\n      imageModal: {\r\n        record: null,\r\n        visible: false,\r\n        type: '1'\r\n      },\r\n      typeList: [],\r\n      count: 0,\r\n      data: [],\r\n      columns,\r\n      image: {\r\n        uuid: null,\r\n        url: null\r\n      },\r\n      images:this.image,\r\n      headers: {\r\n        'X-CSRFToken': getCookie('csrftoken')\r\n      }\r\n    }\r\n  },\r\n  mounted () {\r\n    api.getTypeList(this.project_id)\r\n      .then(data => {\r\n        this.ty = data\r\n      })\r\n    this.getData()\r\n  },\r\n  methods: {\r\n    ...mapGetters(['projectSelected']),\r\n    getData () {\r\n      this.status.loading = true\r\n      api.getAddressList(this.params)\r\n        .then(data => {\r\n          console.log(data)\r\n          this.data = data.results\r\n          this.count = data.count\r\n          this.status.loading = false\r\n        })\r\n      api.getImage(this.project_id)\r\n        .then(data => {\r\n          this.image = data\r\n          console.log(this.image)\r\n          if(data.url==0){\r\n            this.images=null\r\n          }\r\n          else\r\n            this.images=data\r\n          console.log(this.images)\r\n        })\r\n    },\r\n    handleUploadImage () {\r\n      if (this.image.url==0) {\r\n        this.imageModal.type = 'create'\r\n        this.imageModal.record = this.image\r\n        this.imageModal.visible = true\r\n      } else {\r\n        this.imageModal.type = 'edit'\r\n        this.imageModal.visible = true\r\n        this.imageModal.record = this.image\r\n      }\r\n    },\r\n    handleImageClose () {\r\n      this.imageModal.type = ''\r\n      this.imageModal.record = null\r\n      this.imageModal.visible = false\r\n      this.getData()\r\n    },\r\n    handleClearParams () {\r\n      this.params.ordering = 'company'\r\n      this.params.search = ''\r\n      this.params.page = 1\r\n      this.params.company_type = ''\r\n      this.getData()\r\n    },\r\n    handelePage (page) {\r\n      this.params.page = page\r\n      this.getData()\r\n    },\r\n    handleClose () {\r\n      this.modal.type = ''\r\n      this.modal.record = null\r\n      this.modal.visible = false\r\n      this.getData()\r\n    },\r\n    handleCreate () {\r\n      this.modal.type = 'create'\r\n      this.modal.record = null\r\n      this.modal.visible = true\r\n    },\r\n    handleEdit (record) {\r\n      this.modal.type = 'edit'\r\n      this.modal.record = record\r\n      this.modal.visible = true\r\n    },\r\n    handleDelete (record) {\r\n      api.deleteAddressListDetail(record.id)\r\n        .then(data => {\r\n          this.$notification.success({ message: '成功', description: '删除成功', key: 'SUCCESS' })\r\n          this.getData()\r\n        })\r\n      this.getData()\r\n    }\r\n  }\r\n}\r\n",{"version":3,"sources":["Contact.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAsIA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"Contact.vue","sourceRoot":"src/views/detail","sourcesContent":["<template>\r\n  <div>\r\n    <contact-modal\r\n      :record=\"modal.record\"\r\n      :visible=\"modal.visible\"\r\n      :type=\"modal.type\"\r\n      v-if=\"modal.visible\"\r\n      @close=\"handleClose()\">\r\n    </contact-modal>\r\n    <image-modal\r\n      :record=\"imageModal.record\"\r\n      :visible=\"imageModal.visible\"\r\n      :type=\"imageModal.type\"\r\n      v-if=\"imageModal.visible\"\r\n      @close=\"handleImageClose()\">\r\n    </image-modal>\r\n    <a-card>\r\n      <a-row>\r\n        <a-col\r\n          :xs=\"{span: 20, offset: 2}\"\r\n          :sm=\"{span: 16, offset: 4}\"\r\n          :xl=\"{span: 12, offset: 6}\">\r\n          <img v-if=\"images\" class=\"img\" :src=\"images.url\" alt=\"项目图片\">\r\n        </a-col>\r\n      </a-row>\r\n      <a-row :gutter=\"6\">\r\n        <a-col\r\n          class=\"item\"\r\n          :xs=\"{span: 12}\"\r\n          :sm=\"{span: 6}\"\r\n          :xl=\"{span: 4, offset: 2}\">\r\n          <a-select\r\n            v-model=\"params.ordering\"\r\n            style=\"width: 100%\"\r\n            @change=\"getData()\">\r\n            <a-select-option value=\"\">排序</a-select-option>\r\n            <a-select-option value=\"company\">单位正排序</a-select-option>\r\n            <a-select-option value=\"-company\">单位倒排序</a-select-option>\r\n            <a-select-option value=\"name\">姓名正排序</a-select-option>\r\n            <a-select-option value=\"-name\">姓名倒排序</a-select-option>\r\n          </a-select>\r\n        </a-col>\r\n        <a-col\r\n          class=\"item\"\r\n          v-bind=\"layout\">\r\n          <a-select\r\n            v-model=\"params.company_type\"\r\n            style=\"width: 100%\"\r\n            @change=\"getData()\">\r\n            <a-select-option value=\"\">类型筛选</a-select-option>\r\n            <a-select-option :value=\"item.value\" v-for=\"item in typeList\">{{item.label}}</a-select-option>\r\n          </a-select>\r\n        </a-col>\r\n        <a-col\r\n          class=\"item\"\r\n          v-bind=\"layout\">\r\n          <a-input\r\n            v-model=\"params.search\"\r\n            style=\"width: 100%\"\r\n            placeholder=\"单位，姓名，岗位\">\r\n          </a-input>\r\n        </a-col>\r\n        <a-col\r\n          class=\"item\"\r\n          v-bind=\"layout\">\r\n          <a-button\r\n            style=\"width: 100%\"\r\n            icon=\"search\"\r\n            @click=\"getData()\">\r\n            搜索\r\n          </a-button>\r\n        </a-col>\r\n        <a-col\r\n          class=\"item\"\r\n          v-bind=\"layout\">\r\n          <a-button\r\n            style=\"width: 100%\"\r\n            icon=\"delete\"\r\n            @click=\"handleClearParams()\">\r\n            重置\r\n          </a-button>\r\n        </a-col>\r\n        <a-col\r\n          class=\"item\"\r\n          v-bind=\"layout\">\r\n          <a-button\r\n            style=\"width: 100%\"\r\n            icon=\"download\"\r\n            @click=\"handleUploadImage()\">\r\n            上传图片\r\n          </a-button>\r\n        </a-col>\r\n        <a-col\r\n          class=\"item\"\r\n          v-bind=\"layout\">\r\n          <a-button\r\n            type=\"primary\"\r\n            icon=\"plus\"\r\n            style=\"width: 100%\"\r\n            @click=\"handleCreate()\">\r\n            新建\r\n          </a-button>\r\n        </a-col>\r\n      </a-row>\r\n      <a-table\r\n        class=\"item\"\r\n        bordered\r\n        :columns=\"columns\"\r\n        :dataSource=\"data\"\r\n        rowKey=\"id\"\r\n        :pagination=\"false\"\r\n        :loading=\"status.loading\">\r\n        <template slot=\"operation\" slot-scope=\"text, record, index\">\r\n          <a-button class=\"button\" @click=\"handleEdit(record)\">编辑</a-button>\r\n          <a-popconfirm\r\n            title=\"确认删除吗?\"\r\n            @confirm=\"handleDelete(record)\">\r\n            <a-button class=\"button\" type=\"danger\">删除</a-button>\r\n          </a-popconfirm>\r\n        </template>\r\n      </a-table>\r\n      <a-pagination\r\n        class=\"item\"\r\n        v-model=\"params.page\"\r\n        @change=\"handelePage\"\r\n        style=\"float: right\"\r\n        :total=\"count\">\r\n      </a-pagination>\r\n    </a-card>\r\n  </div>\r\n</template>\r\n\r\n<script>\r\n\r\nconst columns = [\r\n  {\r\n    title: '单位',\r\n    dataIndex: 'company',\r\n    width: '10%',\r\n    align: 'center'\r\n  },\r\n  {\r\n    title: '单位类型',\r\n    dataIndex: 'company_type.label',\r\n    width: '14%',\r\n    align: 'center'\r\n  },\r\n  {\r\n    title: '姓名',\r\n    dataIndex: 'name',\r\n    width: '8%',\r\n    align: 'center'\r\n  },\r\n  {\r\n    title: '岗位',\r\n    dataIndex: 'job',\r\n    width: '10%',\r\n    align: 'center'\r\n  },\r\n  {\r\n    title: '邮箱',\r\n    dataIndex: 'email',\r\n    width: '17%',\r\n    align: 'center'\r\n  },\r\n  {\r\n    title: '联系电话',\r\n    dataIndex: 'telephone',\r\n    width: '15%',\r\n    align: 'center'\r\n  },\r\n  {\r\n    title: '备注',\r\n    dataIndex: 'note',\r\n    width: '13%',\r\n    align: 'center'\r\n  },\r\n  {\r\n    title: '编辑',\r\n    dataIndex: 'operation',\r\n    align: 'center',\r\n    scopedSlots: { customRender: 'operation' }\r\n  }\r\n]\r\nimport api from '../../api/detail'\r\nimport ContactModal from './components/ContactModal'\r\nimport ImageModal from './components/ImageModal'\r\nimport { mapGetters } from 'vuex'\r\nimport { getCookie } from '../../utils/util'\r\n\r\nexport default {\r\n  name: 'RelatedCompany',\r\n  components: {\r\n    ContactModal,\r\n    ImageModal\r\n  },\r\n  data () {\r\n    return {\r\n      layout: {\r\n        xs: { span: 12 },\r\n        sm: { span: 6 },\r\n        xl: { span: 3 }\r\n      },\r\n      status: {\r\n        loading: true\r\n      },\r\n      project_id: this.projectSelected().id,\r\n      params: {\r\n        search: '',\r\n        page: 1,\r\n        ordering: '-company',\r\n        company_type: '',\r\n        project_id: this.projectSelected().id\r\n      },\r\n      modal: {\r\n        record: null,\r\n        visible: false,\r\n        type: '1'\r\n      },\r\n      imageModal: {\r\n        record: null,\r\n        visible: false,\r\n        type: '1'\r\n      },\r\n      typeList: [],\r\n      count: 0,\r\n      data: [],\r\n      columns,\r\n      image: {\r\n        uuid: null,\r\n        url: null\r\n      },\r\n      images:this.image,\r\n      headers: {\r\n        'X-CSRFToken': getCookie('csrftoken')\r\n      }\r\n    }\r\n  },\r\n  mounted () {\r\n    api.getTypeList(this.project_id)\r\n      .then(data => {\r\n        this.ty = data\r\n      })\r\n    this.getData()\r\n  },\r\n  methods: {\r\n    ...mapGetters(['projectSelected']),\r\n    getData () {\r\n      this.status.loading = true\r\n      api.getAddressList(this.params)\r\n        .then(data => {\r\n          console.log(data)\r\n          this.data = data.results\r\n          this.count = data.count\r\n          this.status.loading = false\r\n        })\r\n      api.getImage(this.project_id)\r\n        .then(data => {\r\n          this.image = data\r\n          console.log(this.image)\r\n          if(data.url==0){\r\n            this.images=null\r\n          }\r\n          else\r\n            this.images=data\r\n          console.log(this.images)\r\n        })\r\n    },\r\n    handleUploadImage () {\r\n      if (this.image.url==0) {\r\n        this.imageModal.type = 'create'\r\n        this.imageModal.record = this.image\r\n        this.imageModal.visible = true\r\n      } else {\r\n        this.imageModal.type = 'edit'\r\n        this.imageModal.visible = true\r\n        this.imageModal.record = this.image\r\n      }\r\n    },\r\n    handleImageClose () {\r\n      this.imageModal.type = ''\r\n      this.imageModal.record = null\r\n      this.imageModal.visible = false\r\n      this.getData()\r\n    },\r\n    handleClearParams () {\r\n      this.params.ordering = 'company'\r\n      this.params.search = ''\r\n      this.params.page = 1\r\n      this.params.company_type = ''\r\n      this.getData()\r\n    },\r\n    handelePage (page) {\r\n      this.params.page = page\r\n      this.getData()\r\n    },\r\n    handleClose () {\r\n      this.modal.type = ''\r\n      this.modal.record = null\r\n      this.modal.visible = false\r\n      this.getData()\r\n    },\r\n    handleCreate () {\r\n      this.modal.type = 'create'\r\n      this.modal.record = null\r\n      this.modal.visible = true\r\n    },\r\n    handleEdit (record) {\r\n      this.modal.type = 'edit'\r\n      this.modal.record = record\r\n      this.modal.visible = true\r\n    },\r\n    handleDelete (record) {\r\n      api.deleteAddressListDetail(record.id)\r\n        .then(data => {\r\n          this.$notification.success({ message: '成功', description: '删除成功', key: 'SUCCESS' })\r\n          this.getData()\r\n        })\r\n      this.getData()\r\n    }\r\n  }\r\n}\r\n</script>\r\n\r\n<style lang=\"less\" scoped>\r\n  @import '~ant-design-vue/es/style/themes/default';\r\n\r\n  .item {\r\n    margin: 10px 0;\r\n  }\r\n\r\n  .img {\r\n    display: block;\r\n    margin: 0 auto 20px auto;\r\n    width: 100%;\r\n    border-radius: @border-radius-base;\r\n    box-shadow: 0 0 5px @shadow-color;\r\n  }\r\n</style>"]}]}