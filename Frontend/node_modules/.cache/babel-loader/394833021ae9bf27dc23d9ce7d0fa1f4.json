{"remainingRequest":"E:\\FoodProductManagementSystem\\Frontend\\node_modules\\babel-loader\\lib\\index.js!E:\\FoodProductManagementSystem\\Frontend\\node_modules\\cache-loader\\dist\\cjs.js??ref--0-0!E:\\FoodProductManagementSystem\\Frontend\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!E:\\FoodProductManagementSystem\\Frontend\\src\\views\\detail\\components\\ImageModal.vue?vue&type=script&lang=js&","dependencies":[{"path":"E:\\FoodProductManagementSystem\\Frontend\\src\\views\\detail\\components\\ImageModal.vue","mtime":1572857662654},{"path":"E:\\FoodProductManagementSystem\\Frontend\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"E:\\FoodProductManagementSystem\\Frontend\\node_modules\\babel-loader\\lib\\index.js","mtime":499162500000},{"path":"E:\\FoodProductManagementSystem\\Frontend\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"E:\\FoodProductManagementSystem\\Frontend\\node_modules\\vue-loader\\lib\\index.js","mtime":499162500000}],"contextDependencies":[],"result":["import \"core-js/modules/es6.function.name\";\nimport \"core-js/modules/es6.regexp.to-string\";\nimport \"core-js/modules/es6.object.to-string\";\nimport _objectSpread from \"E:\\\\FoodProductManagementSystem\\\\Frontend\\\\node_modules\\\\@babel\\\\runtime-corejs2/helpers/esm/objectSpread\";\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\nimport api from '../../../api/detail';\nimport { mapGetters } from 'vuex';\nimport { getCookie } from '../../../utils/util';\nexport default {\n  name: 'ImageModal',\n  props: {\n    record: Object,\n    visible: Boolean,\n    type: String\n  },\n  data: function data() {\n    return {\n      layout: {\n        'label-col': {\n          span: 8\n        },\n        'wrapper-col': {\n          span: 16\n        }\n      },\n      status: {\n        img: {\n          loading: false\n        }\n      },\n      form: this.$form.createForm(this),\n      typeList: [],\n      project_id: this.projectSelected().id,\n      image: {\n        uuid: null,\n        url: null\n      },\n      headers: {\n        'X-CSRFToken': getCookie('csrftoken')\n      }\n    };\n  },\n  mounted: function mounted() {\n    if (this.record.url != 0) this.image = this.record;\n  },\n  methods: _objectSpread({}, mapGetters(['projectSelected']), {\n    handleOk: function handleOk() {\n      var _this = this;\n\n      this.form.validateFields(function (error, data) {\n        if (!error) {\n          data.uuid = _this.image.uuid;\n\n          if (_this.record.url == 0) {\n            api.createImage(_this.project_id, data).then(function (data) {\n              _this.$emit('close');\n\n              _this.$notification.success({\n                message: '成功',\n                description: '新建成功',\n                key: 'SUCCESS'\n              });\n            });\n          } else {\n            api.deleteImage(_this.project_id).then(function (data) {\n              _this.$emit('close');\n\n              _this.$notification.success({\n                message: '成功',\n                description: '删除成功',\n                key: 'SUCCESS'\n              });\n            });\n            api.createImage(_this.project_id, data).then(function (data) {\n              _this.$emit('close');\n\n              _this.$notification.success({\n                message: '成功',\n                description: '新建成功',\n                key: 'SUCCESS'\n              });\n            });\n          }\n        }\n      });\n    },\n    handleImageChange: function handleImageChange(info) {\n      if (info.file.status === 'uploading') {\n        this.loading = true;\n      } else if (info.file.status === 'done') {\n        this.image.uuid = info.file.response.uuid;\n        this.image.url = info.file.response.url.toString();\n        this.loading = false;\n        console.log(\"this.image\");\n        console.log(this.image);\n      } else if (info.file.status === 'error') {\n        this.$message.error(\"\".concat(info.file.name, \" \\u4E0A\\u4F20\\u5931\\u8D25.\"));\n        this.loading = false;\n      }\n    },\n    beforeUpload: function beforeUpload(file) {\n      var isImage = /image\\/*/.test(file.type);\n\n      if (!isImage) {\n        this.$message.error('图片格式不正确');\n      }\n\n      var isLt2M = file.size / 1024 / 1024 <= 100;\n\n      if (!isLt2M) {\n        this.$message.error('图片大小请小于100MB');\n      }\n\n      return isImage && isLt2M;\n    },\n    handleCancel: function handleCancel() {\n      this.$emit('close');\n    }\n  }),\n  computed: {\n    isEdit: function isEdit() {\n      return this.type === 'edit';\n    },\n    title: function title() {\n      return this.isEdit ? '编辑' : '新建';\n    }\n  }\n};",{"version":3,"sources":["ImageModal.vue"],"names":[],"mappings":"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","sourcesContent":["<template>\r\n  <a-modal\r\n    :title=\"title\"\r\n    :visible=\"visible\"\r\n    :keyboard=\"false\"\r\n    :maskClosable=\"false\"\r\n    okText=\"保存\"\r\n    okType=\"primary\"\r\n    @ok=\"handleOk()\"\r\n    @cancel=\"handleCancel()\">\r\n    <a-form\r\n      :form=\"form\">\r\n      <a-form-item\r\n        label=\"项目图片\"\r\n        v-bind=\"layout\">\r\n        <a-upload\r\n          name=\"image\"\r\n          action=\"/api/file/\"\r\n          :withCredentials=\"true\"\r\n          :headers=\"headers\"\r\n          accept=\"image/*\"\r\n          listType=\"picture-card\"\r\n          :showUploadList=\"false\"\r\n          :beforeUpload=\"beforeUpload\"\r\n          @change=\"handleImageChange\">\r\n          <img v-if=\"image.url\" :src=\"image.url\" alt=\"项目图片\" width=\"200px\"/>\r\n          <div v-else style=\"width: 100px\">\r\n            <a-icon :type=\"status.img.loading ? 'loading' : 'plus'\"/>\r\n            <div class=\"text\">选择图片</div>\r\n          </div>\r\n        </a-upload>\r\n        <span>支持图片文件，不大于2MB</span>\r\n      </a-form-item>\r\n    </a-form>\r\n  </a-modal>\r\n</template>\r\n\r\n<script>\r\nimport api from '../../../api/detail'\r\nimport { mapGetters } from 'vuex'\r\nimport { getCookie } from '../../../utils/util'\r\n\r\nexport default {\r\n  name: 'ImageModal',\r\n  props: {\r\n    record: Object,\r\n    visible: Boolean,\r\n    type: String\r\n  },\r\n  data () {\r\n    return {\r\n      layout: {\r\n        'label-col': { span: 8 },\r\n        'wrapper-col': { span: 16 }\r\n      },\r\n      status: {\r\n        img: {\r\n          loading: false\r\n        }\r\n      },\r\n      form: this.$form.createForm(this),\r\n      typeList: [],\r\n      project_id: this.projectSelected().id,\r\n      image: {\r\n        uuid: null,\r\n        url: null\r\n      },\r\n      headers: {\r\n        'X-CSRFToken': getCookie('csrftoken')\r\n      }\r\n    }\r\n  },\r\n  mounted () {\r\n    if(this.record.url!=0)\r\n      this.image=this.record\r\n  },\r\n  methods: {\r\n    ...mapGetters(['projectSelected']),\r\n    handleOk () {\r\n      this.form.validateFields((error, data) => {\r\n        if (!error) {\r\n          data.uuid = this.image.uuid\r\n          if(this.record.url==0){\r\n            api.createImage(this.project_id, data)\r\n            .then(data => {\r\n              this.$emit('close')\r\n              this.$notification.success({ message: '成功', description: '新建成功', key: 'SUCCESS' })\r\n            })\r\n          }\r\n          else{\r\n            api.deleteImage(this.project_id)\r\n            .then(data => {\r\n              this.$emit('close')\r\n              this.$notification.success({ message: '成功', description: '删除成功', key: 'SUCCESS' })\r\n            })\r\n            api.createImage(this.project_id, data)\r\n            .then(data => {\r\n              this.$emit('close')\r\n              this.$notification.success({ message: '成功', description: '新建成功', key: 'SUCCESS' })\r\n            })\r\n          }\r\n        }\r\n      })\r\n    },\r\n    handleImageChange (info) {\r\n      if (info.file.status === 'uploading') {\r\n        this.loading = true\r\n      } else if (info.file.status === 'done') {\r\n        this.image.uuid = info.file.response.uuid\r\n        this.image.url = info.file.response.url.toString()\r\n        this.loading = false\r\n        console.log(\"this.image\")\r\n        console.log(this.image)\r\n      } else if (info.file.status === 'error') {\r\n        this.$message.error(`${info.file.name} 上传失败.`)\r\n        this.loading = false\r\n      }\r\n    },\r\n    beforeUpload (file) {\r\n      const isImage = /image\\/*/.test(file.type)\r\n      if (!isImage) {\r\n        this.$message.error('图片格式不正确')\r\n      }\r\n      const isLt2M = file.size / 1024 / 1024 <= 100\r\n      if (!isLt2M) {\r\n        this.$message.error('图片大小请小于100MB')\r\n      }\r\n      return isImage && isLt2M\r\n    },\r\n    handleCancel () {\r\n      this.$emit('close')\r\n    }\r\n  },\r\n  computed: {\r\n    isEdit () {\r\n      return this.type === 'edit'\r\n    },\r\n    title () {\r\n      return this.isEdit ? '编辑' : '新建'\r\n    }\r\n  }\r\n}\r\n</script>\r\n\r\n<style scoped lang=\"less\">\r\n\r\n</style>"],"sourceRoot":"src/views/detail/components"}]}