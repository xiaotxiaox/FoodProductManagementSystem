{"remainingRequest":"E:\\ConstructionConsultationSystem\\Frontend\\node_modules\\babel-loader\\lib\\index.js!E:\\ConstructionConsultationSystem\\Frontend\\node_modules\\cache-loader\\dist\\cjs.js??ref--0-0!E:\\ConstructionConsultationSystem\\Frontend\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!E:\\ConstructionConsultationSystem\\Frontend\\src\\views\\implement\\design\\Design.vue?vue&type=script&lang=js&","dependencies":[{"path":"E:\\ConstructionConsultationSystem\\Frontend\\src\\views\\implement\\design\\Design.vue","mtime":1572857662693},{"path":"E:\\ConstructionConsultationSystem\\Frontend\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"E:\\ConstructionConsultationSystem\\Frontend\\node_modules\\babel-loader\\lib\\index.js","mtime":499162500000},{"path":"E:\\ConstructionConsultationSystem\\Frontend\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"E:\\ConstructionConsultationSystem\\Frontend\\node_modules\\vue-loader\\lib\\index.js","mtime":499162500000}],"contextDependencies":[],"result":["import \"core-js/modules/es6.function.name\";\nimport _parseFloat from \"E:\\\\ConstructionConsultationSystem\\\\Frontend\\\\node_modules\\\\@babel\\\\runtime-corejs2/core-js/parse-float\";\nimport _getIterator from \"E:\\\\ConstructionConsultationSystem\\\\Frontend\\\\node_modules\\\\@babel\\\\runtime-corejs2/core-js/get-iterator\";\nimport \"core-js/modules/es6.number.constructor\";\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\nimport DesignMoneyModal from './components/DesignMoneyModal';\nimport echarts from 'echarts';\nvar columns = [{\n  title: '设计单位名称',\n  dataIndex: 'name',\n  width: '12%',\n  align: 'center'\n}, {\n  title: '类别',\n  dataIndex: 'type',\n  width: '8%',\n  align: 'center'\n}, {\n  title: '项目名称',\n  dataIndex: 'project_name',\n  width: '12%',\n  align: 'center'\n}, {\n  title: '合同额',\n  dataIndex: 'contract_price',\n  width: '11%',\n  align: 'center'\n}, {\n  title: '结算额',\n  dataIndex: 'settled_price',\n  width: '11%',\n  align: 'center'\n}, {\n  title: '支付累计',\n  dataIndex: 'paid_total',\n  width: '12%',\n  align: 'center'\n}, {\n  title: '本次应付',\n  dataIndex: 'should_pay',\n  width: '10%',\n  align: 'center'\n}, {\n  title: '支付详情',\n  dataIndex: 'operation5',\n  scopedSlots: {\n    customRender: 'operation5'\n  },\n  align: 'center'\n}, {\n  title: '比例',\n  width: '10%',\n  align: 'center',\n  scopedSlots: {\n    customRender: 'ratio'\n  }\n}, {\n  title: '编辑',\n  dataIndex: 'operation',\n  scopedSlots: {\n    customRender: 'operation'\n  },\n  align: 'center'\n}];\nimport api from '../../../api/implement';\nexport default {\n  name: 'Design',\n  components: {\n    DesignMoneyModal: DesignMoneyModal\n  },\n  props: {\n    id: Number\n  },\n  data: function data() {\n    return {\n      columns: columns,\n      designItemList: [],\n      list: [],\n      current: 0,\n      doing_id: null,\n      designCompanyList: [],\n      status: {\n        listLoading: true,\n        tableLoading: true\n      },\n      moneys: {},\n      modal: {\n        record: null,\n        visible: false,\n        type: '1',\n        company_id: this.company_id\n      },\n      charts: '',\n      opinion: ['合同额', '支付累计'],\n      opinionData: [{\n        value: 100,\n        name: '合同额',\n        itemStyle: {\n          color: '#00b0f0'\n        }\n      }, {\n        value: 0,\n        name: '支付累计',\n        itemStyle: {\n          color: '#7030a0'\n        }\n      }]\n    };\n  },\n  mounted: function mounted() {\n    this.getData();\n    this.$nextTick(function () {\n      this.drawPie('main');\n    });\n  },\n  methods: {\n    getData: function getData() {\n      this.getDesignItemList();\n      this.getDesignCompanyList();\n    },\n    getDesignItemList: function getDesignItemList() {\n      var _this = this;\n\n      this.status.listLoading = true;\n      api.getDesignItemList(this.project_id).then(function (data) {\n        _this.designItemList = data.slice(0, 12);\n        _this.list[0] = data[12];\n        _this.list[1] = data[8];\n        _this.list[2] = data[13];\n\n        _this.getDesignItemDoing();\n\n        _this.status.listLoading = false;\n      });\n    },\n    getDesignItemDoing: function getDesignItemDoing() {\n      var _this2 = this;\n\n      api.getDesignItemDoing(this.project_id).then(function (data) {\n        _this2.current = data[0].design_item - _this2.designItemList[0].design_item_id;\n        _this2.doing_id = data[0].id;\n      });\n    },\n    getDesignCompanyList: function getDesignCompanyList() {\n      var _this3 = this;\n\n      this.status.tableLoading = true;\n      api.getDesignCompanyList(this.project_id).then(function (data) {\n        console.log(data);\n        _this3.designCompanyList = data;\n        var sumC = 0;\n        var sumAdd = 0;\n        var _iteratorNormalCompletion = true;\n        var _didIteratorError = false;\n        var _iteratorError = undefined;\n\n        try {\n          for (var _iterator = _getIterator(data), _step; !(_iteratorNormalCompletion = (_step = _iterator.next()).done); _iteratorNormalCompletion = true) {\n            var i = _step.value;\n            sumC = sumC + i.contract_price;\n            sumAdd = sumAdd + i.paid_total;\n          }\n        } catch (err) {\n          _didIteratorError = true;\n          _iteratorError = err;\n        } finally {\n          try {\n            if (!_iteratorNormalCompletion && _iterator.return != null) {\n              _iterator.return();\n            }\n          } finally {\n            if (_didIteratorError) {\n              throw _iteratorError;\n            }\n          }\n        }\n\n        console.log(data);\n        _this3.opinionData[0].value = sumC - sumAdd;\n        _this3.opinionData[1].value = sumAdd;\n        _this3.status.tableLoading = false;\n\n        _this3.$nextTick(function () {\n          this.drawPie('main');\n        });\n      });\n    },\n    handleChangeCurrent: function handleChangeCurrent(item) {\n      var _this4 = this;\n\n      this.current = item.design_item_id - this.designItemList[0].design_item_id;\n      api.updateDesignItemDoing(this.doing_id, item.design_item_id).then(function (data) {\n        _this4.$notification.success({\n          message: '成功',\n          description: '更换正在进行项目成功',\n          key: 'SUCCESS'\n        });\n      });\n    },\n    getIconType: function getIconType(item) {\n      var ret = '';\n\n      if (item.design_item_id - this.designItemList[0].design_item_id < this.current) {\n        ret = 'check-circle';\n      } else if (item.design_item_id - this.designItemList[0].design_item_id === this.current) {\n        ret = 'clock-circle';\n      } else {\n        ret = 'minus-circle';\n      }\n\n      return ret;\n    },\n    handleClose: function handleClose() {\n      this.modal.type = '';\n      this.modal.record = null;\n      this.modal.visible = false;\n      this.getDesignCompanyList();\n    },\n    handleCreate: function handleCreate() {\n      this.modal.type = 'create';\n      this.modal.record = null;\n      this.modal.visible = true;\n    },\n    handleEdit: function handleEdit(record) {\n      this.modal.type = 'edit';\n      this.modal.record = record;\n      this.modal.visible = true;\n      console.log(record);\n    },\n    handleDelete: function handleDelete(record) {\n      var _this5 = this;\n\n      api.deleteDesignCompany(record.company_id).then(function (data) {\n        _this5.$notification.success({\n          message: '成功',\n          description: '删除成功',\n          key: 'SUCCESS'\n        });\n\n        _this5.getDesignCompanyList();\n      });\n    },\n    getRatio: function getRatio(record) {\n      var paid_total = _parseFloat(record.paid_total);\n\n      var settled_price = _parseFloat(record.settled_price);\n\n      if (paid_total && settled_price) {\n        return \"\".concat((paid_total / settled_price * 100).toFixed(2), \" %\");\n      } else {\n        return '';\n      }\n    },\n    drawPie: function drawPie(id) {\n      this.charts = echarts.init(document.getElementById(id));\n      this.charts.setOption({\n        tooltip: {\n          formatter: function formatter(params, ticket, callback) {\n            if (params.name == '支付累计') return params.name + ':' + params.percent + '%';\n          },\n          trigger: 'item'\n        },\n        legend: {\n          orient: 'vertical',\n          x: 'left',\n          data: this.opinion\n        },\n        series: [{\n          name: '数量',\n          type: 'pie',\n          radius: ['0%', '70%'],\n          avoidLabelOverlap: false,\n          label: {\n            normal: {\n              show: true,\n              position: 'inside'\n            },\n            emphasis: {\n              show: true,\n              textStyle: {\n                fontSize: '30',\n                fontWeight: 'blod'\n              }\n            }\n          },\n          labelLine: {\n            normal: {\n              show: false\n            }\n          },\n          data: this.opinionData\n        }]\n      });\n    }\n  },\n  computed: {\n    project_id: function project_id() {\n      return this.$store.getters.projectSelected.id;\n    }\n  }\n};",{"version":3,"sources":["Design.vue"],"names":[],"mappings":"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","sourcesContent":["<template>\r\n  <div>\r\n    <a-card style=\"margin-bottom: 16px\">\r\n      <a-spin :spinning=\"status.listLoading\">\r\n        <a-steps size=\"small\" :current=\"current\">\r\n          <a-step\r\n            v-for=\"item in designItemList\"\r\n            :key=\"item.design_item_id\">\r\n            <template slot=\"title\">\r\n              <router-link :to=\"{'name': 'implementDesignDetail', params: {id: item.design_item_id}}\">{{item.name}}\r\n              </router-link>\r\n            </template>\r\n            <template slot=\"icon\">\r\n              <a-popconfirm title=\"设置为正在进行\" @confirm=\"handleChangeCurrent(item)\">\r\n                <a-icon\r\n                  :type=\"getIconType(item)\"\r\n                  :theme=\"item.design_item_id - designItemList[0].design_item_id === current ? 'filled' : 'outlined'\"\r\n                  style=\"cursor: pointer\"></a-icon>\r\n              </a-popconfirm>\r\n            </template>\r\n          </a-step>\r\n        </a-steps>\r\n      </a-spin>\r\n    </a-card>\r\n    <a-card style=\"margin-bottom: 16px\">\r\n      <a-spin :spinning=\"status.listLoading\">\r\n        <a-row :gutter=\"16\">\r\n          <a-col\r\n            v-for=\"item in list\"\r\n            :key=\"item.id\"\r\n            :xs=\"{ span: 24 }\"\r\n            :sm=\"{ span: 8 }\"\r\n            :xl=\"{ span: 8 }\">\r\n            <a-card\r\n              class=\"card\"\r\n              @click=\"$router.push({'name': 'implementDesignDetail', params: {id: item.design_item_id}})\">\r\n              {{item.name}}\r\n            </a-card>\r\n          </a-col>\r\n        </a-row>\r\n      </a-spin>\r\n    </a-card>\r\n    <div>\r\n      <design-money-modal\r\n        :record=\"modal.record\"\r\n        :visible=\"modal.visible\"\r\n        :type=\"modal.type\"\r\n        :company_id=\"modal.company_id\"\r\n        v-if=\"modal.visible\"\r\n        @close=\"handleClose()\">\r\n      </design-money-modal>\r\n      <a-card>\r\n        <a-row>\r\n          <a-col\r\n            :xs=\"{ span: 24 }\"\r\n            :sm=\"{ span: 24 }\"\r\n            :xl=\"{ span: 12 ,offset:6}\">\r\n            <div style=\"width: 100%;height:100%;text-align: center\">\r\n              <div id=\"main\" style=\"width: 100%;height: 400px;\"></div>\r\n            </div>\r\n          </a-col>\r\n        </a-row>\r\n        <a-row class=\"item\">\r\n          <a-col\r\n            :xs=\"{ span: 24 }\"\r\n            :sm=\"{ span: 12, offset: 12 }\"\r\n            :xl=\"{ span: 4, offset: 20 }\">\r\n            <a-button\r\n              type=\"primary\"\r\n              icon=\"plus\"\r\n              style=\"width: 100%\"\r\n              @click=\"handleCreate()\">\r\n              新建\r\n            </a-button>\r\n          </a-col>\r\n        </a-row>\r\n        <a-table\r\n          bordered\r\n          :columns=\"columns\"\r\n          :dataSource=\"designCompanyList\"\r\n          rowKey=\"company_id\"\r\n          :loading=\"status.tableLoading\"\r\n          :pagination=\"false\">\r\n          <template slot=\"operation5\" slot-scope=\"text, record, index\">\r\n            <a-button @click=\"$router.push({'name': 'paymentDetail', params: {id: record.company_id}})\">查看</a-button>\r\n          </template>\r\n          <template slot=\"ratio\" slot-scope=\"text, record, index\">\r\n            {{getRatio(record)}}\r\n          </template>\r\n          <template slot=\"operation\" slot-scope=\"text, record, index\">\r\n            <a-button @click=\"handleEdit(record)\">编辑</a-button>\r\n            <a-popconfirm\r\n              title=\"确认删除吗?\"\r\n              @confirm=\"handleDelete(record)\">\r\n              <a-button type=\"danger\">删除</a-button>\r\n            </a-popconfirm>\r\n          </template>\r\n        </a-table>\r\n      </a-card>\r\n    </div>\r\n\r\n  </div>\r\n</template>\r\n\r\n<script>\r\nimport DesignMoneyModal from './components/DesignMoneyModal'\r\nimport echarts from 'echarts'\r\n\r\nconst columns = [\r\n  {\r\n    title: '设计单位名称',\r\n    dataIndex: 'name',\r\n    width: '12%',\r\n    align: 'center'\r\n  },\r\n  {\r\n    title: '类别',\r\n    dataIndex: 'type',\r\n    width: '8%',\r\n    align: 'center'\r\n  },\r\n  {\r\n    title: '项目名称',\r\n    dataIndex: 'project_name',\r\n    width: '12%',\r\n    align: 'center'\r\n  },\r\n  {\r\n    title: '合同额',\r\n    dataIndex: 'contract_price',\r\n    width: '11%',\r\n    align: 'center'\r\n  },\r\n  {\r\n    title: '结算额',\r\n    dataIndex: 'settled_price',\r\n    width: '11%',\r\n    align: 'center'\r\n  },\r\n  {\r\n    title: '支付累计',\r\n    dataIndex: 'paid_total',\r\n    width: '12%',\r\n    align: 'center'\r\n  },\r\n  {\r\n    title: '本次应付',\r\n    dataIndex: 'should_pay',\r\n    width: '10%',\r\n    align: 'center'\r\n  },\r\n  {\r\n    title: '支付详情',\r\n    dataIndex: 'operation5',\r\n    scopedSlots: { customRender: 'operation5' },\r\n    align: 'center'\r\n  },\r\n  {\r\n    title: '比例',\r\n    width: '10%',\r\n    align: 'center',\r\n    scopedSlots: { customRender: 'ratio' }\r\n  },\r\n  {\r\n    title: '编辑',\r\n    dataIndex: 'operation',\r\n    scopedSlots: { customRender: 'operation' },\r\n    align: 'center'\r\n  }\r\n]\r\nimport api from '../../../api/implement'\r\n\r\nexport default {\r\n  name: 'Design',\r\n  components: { DesignMoneyModal },\r\n   props: {\r\n      id: Number\r\n    },\r\n  data () {\r\n    return {\r\n      columns,\r\n      designItemList: [],\r\n      list: [],\r\n      current: 0,\r\n      doing_id: null,\r\n      designCompanyList: [],\r\n      status: {\r\n        listLoading: true,\r\n        tableLoading: true\r\n      },\r\n      moneys: {},\r\n      modal: {\r\n        record: null,\r\n        visible: false,\r\n        type: '1',\r\n        company_id: this.company_id\r\n      },\r\n      charts: '',\r\n      opinion: ['合同额', '支付累计'],\r\n      opinionData: [\r\n        { value: 100, name: '合同额', itemStyle: { color: '#00b0f0' } },\r\n        { value: 0, name: '支付累计', itemStyle: { color: '#7030a0' } },\r\n      ],\r\n    }\r\n  },\r\n  mounted () {\r\n    this.getData()\r\n    this.$nextTick(function () {\r\n      this.drawPie('main')\r\n    })\r\n  },\r\n  methods: {\r\n    getData () {\r\n      this.getDesignItemList()\r\n      this.getDesignCompanyList()\r\n    },\r\n    getDesignItemList () {\r\n      this.status.listLoading = true\r\n      api.getDesignItemList(this.project_id)\r\n        .then(data => {\r\n          this.designItemList = data.slice(0, 12)\r\n          this.list[0] = data[12]\r\n          this.list[1] = data[8]\r\n          this.list[2] = data[13]\r\n          this.getDesignItemDoing()\r\n          this.status.listLoading = false\r\n        })\r\n    },\r\n    getDesignItemDoing () {\r\n      api.getDesignItemDoing(this.project_id)\r\n        .then(data => {\r\n          this.current = data[0].design_item - this.designItemList[0].design_item_id\r\n          this.doing_id = data[0].id\r\n        })\r\n    },\r\n    getDesignCompanyList () {\r\n      this.status.tableLoading = true\r\n      api.getDesignCompanyList(this.project_id)\r\n        .then(data => {\r\n          console.log(data)\r\n          this.designCompanyList = data\r\n          var sumC = 0\r\n          var sumAdd = 0\r\n          for (var i of data) {\r\n            sumC = sumC + i.contract_price\r\n            sumAdd = sumAdd + i.paid_total\r\n          }\r\n          console.log(data)\r\n          this.opinionData[0].value = sumC - sumAdd\r\n          this.opinionData[1].value = sumAdd\r\n          this.status.tableLoading = false\r\n          this.$nextTick(function () {\r\n            this.drawPie('main')\r\n          })\r\n        })\r\n    },\r\n    handleChangeCurrent (item) {\r\n      this.current = item.design_item_id - this.designItemList[0].design_item_id\r\n      api.updateDesignItemDoing(this.doing_id, item.design_item_id)\r\n        .then(data => {\r\n          this.$notification.success({ message: '成功', description: '更换正在进行项目成功', key: 'SUCCESS' })\r\n        })\r\n    },\r\n    getIconType (item) {\r\n      let ret = ''\r\n      if (item.design_item_id - this.designItemList[0].design_item_id < this.current) {\r\n        ret = 'check-circle'\r\n      } else if (item.design_item_id - this.designItemList[0].design_item_id === this.current) {\r\n        ret = 'clock-circle'\r\n      } else {\r\n        ret = 'minus-circle'\r\n      }\r\n      return ret\r\n    },\r\n    handleClose () {\r\n      this.modal.type = ''\r\n      this.modal.record = null\r\n      this.modal.visible = false\r\n      this.getDesignCompanyList()\r\n    },\r\n    handleCreate () {\r\n      this.modal.type = 'create'\r\n      this.modal.record = null\r\n      this.modal.visible = true\r\n    },\r\n    handleEdit (record) {\r\n      this.modal.type = 'edit'\r\n      this.modal.record = record\r\n      this.modal.visible = true\r\n      console.log(record)\r\n    },\r\n    handleDelete (record) {\r\n      api.deleteDesignCompany(record.company_id)\r\n        .then(data => {\r\n          this.$notification.success({ message: '成功', description: '删除成功', key: 'SUCCESS' })\r\n          this.getDesignCompanyList()\r\n        })\r\n    },\r\n    getRatio (record) {\r\n      let paid_total = parseFloat(record.paid_total)\r\n      let settled_price = parseFloat(record.settled_price)\r\n      if (paid_total && settled_price) {\r\n        return `${((paid_total / settled_price) * 100).toFixed(2)} %`\r\n      } else {\r\n        return ''\r\n      }\r\n    },\r\n    drawPie (id) {\r\n      this.charts = echarts.init(document.getElementById(id))\r\n      this.charts.setOption({\r\n        tooltip: {\r\n          formatter: function (params, ticket, callback) {\r\n            if (params.name == '支付累计')\r\n              return params.name + ':' + params.percent + '%'\r\n          },\r\n          trigger: 'item',\r\n        },\r\n        legend: {\r\n          orient: 'vertical',\r\n          x: 'left',\r\n          data: this.opinion\r\n        },\r\n        series: [\r\n          {\r\n            name: '数量',\r\n            type: 'pie',\r\n            radius: ['0%', '70%'],\r\n            avoidLabelOverlap: false,\r\n            label: {\r\n              normal: {\r\n                show: true,\r\n                position: 'inside'\r\n              },\r\n              emphasis: {\r\n\r\n                show: true,\r\n                textStyle: {\r\n                  fontSize: '30',\r\n                  fontWeight: 'blod'\r\n                }\r\n              }\r\n            },\r\n            labelLine: {\r\n              normal: {\r\n                show: false\r\n              }\r\n            },\r\n            data: this.opinionData\r\n          }\r\n        ]\r\n      })\r\n    },\r\n  },\r\n  computed: {\r\n    project_id () {\r\n      return this.$store.getters.projectSelected.id\r\n    }\r\n  }\r\n}\r\n</script>\r\n\r\n<style scoped lang=\"less\">\r\n  @import '../../../../public/color';\r\n\r\n  .item {\r\n    margin-bottom: 16px;\r\n  }\r\n\r\n  .ant-timeline-item-last {\r\n    height: 20px;\r\n    padding: 0;\r\n  }\r\n\r\n  .card {\r\n    text-align: center;\r\n\r\n    &:hover {\r\n      border-color: @primary-color;\r\n      box-shadow: 0 0 1px @primary-color;\r\n    }\r\n  }\r\n</style>"],"sourceRoot":"src/views/implement/design"}]}