{"remainingRequest":"E:\\ConstructionConsultationSystem\\Frontend\\node_modules\\thread-loader\\dist\\cjs.js!E:\\ConstructionConsultationSystem\\Frontend\\node_modules\\babel-loader\\lib\\index.js!E:\\ConstructionConsultationSystem\\Frontend\\node_modules\\eslint-loader\\index.js??ref--13-0!E:\\ConstructionConsultationSystem\\Frontend\\src\\permission.js","dependencies":[{"path":"E:\\ConstructionConsultationSystem\\Frontend\\src\\permission.js","mtime":1555582478363},{"path":"E:\\ConstructionConsultationSystem\\Frontend\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"E:\\ConstructionConsultationSystem\\Frontend\\node_modules\\thread-loader\\dist\\cjs.js","mtime":499162500000},{"path":"E:\\ConstructionConsultationSystem\\Frontend\\node_modules\\babel-loader\\lib\\index.js","mtime":499162500000},{"path":"E:\\ConstructionConsultationSystem\\Frontend\\node_modules\\eslint-loader\\index.js","mtime":499162500000}],"contextDependencies":[],"result":["import \"core-js/modules/es6.function.name\";\nimport \"core-js/modules/es7.array.includes\";\nimport _objectSpread from \"E:\\\\ConstructionConsultationSystem\\\\Frontend\\\\node_modules\\\\@babel\\\\runtime-corejs2/helpers/esm/objectSpread\";\nimport Vue from 'vue';\nimport router from './router';\nimport store from './store';\nimport cookie from 'js-cookie';\nimport NProgress from 'nprogress'; // progress bar\n\nimport 'nprogress/nprogress.css'; // progress bar style\n\nimport notification from 'ant-design-vue/es/notification';\nNProgress.configure({\n  showSpinner: false\n}); // NProgress Configuration\n\nvar whiteList = ['login']; // no redirect whitelist\n\nrouter.beforeEach(function (to, from, next) {\n  NProgress.start(); // start progress bar\n\n  var isLogin = cookie.get('sessionid');\n\n  if (isLogin) {\n    if (to.path === '/user/login') {\n      next({\n        path: '/project'\n      });\n      NProgress.done();\n    } else {\n      if (store.getters.role.length === 0) {\n        store.dispatch('GetInfo').then(function (res) {\n          var roles = res.result && res.result.role;\n          store.dispatch('GenerateRoutes', {\n            roles: roles\n          }).then(function () {\n            router.addRoutes(store.getters.addRouters);\n            var redirect = decodeURIComponent(from.query.redirect || to.path);\n\n            if (to.path === redirect) {\n              next(_objectSpread({}, to, {\n                replace: true\n              }));\n            } else {\n              next({\n                path: redirect\n              });\n            }\n          });\n        }).catch(function () {\n          notification.error({\n            message: '错误',\n            description: '请求用户信息失败，请重试'\n          });\n          store.dispatch('Logout').then(function () {\n            next({\n              path: '/user/login',\n              query: {\n                redirect: to.fullPath\n              }\n            });\n          });\n        });\n      } else {\n        next();\n      }\n    }\n  } else {\n    if (whiteList.includes(to.name)) {\n      next();\n    } else {\n      next({\n        path: '/user/login',\n        query: {\n          redirect: to.fullPath\n        }\n      });\n      NProgress.done();\n    }\n  }\n});\nrouter.afterEach(function () {\n  NProgress.done();\n});\n/**\r\n * Action 权限指令\r\n * 指令用法：\r\n *  - 在需要控制 name 级别权限的组件上使用 v-name:[method] , 如下：\r\n *    <i-button v-action:add >添加用户</a-button>\r\n *    <a-button v-action:delete>删除用户</a-button>\r\n *    <a v-action:edit @click=\"edit(record)\">修改</a>\r\n *\r\n *  - 当前用户没有权限时，组件上使用了该指令则会被隐藏\r\n *  - 当后台权限跟 pro 提供的模式不同时，只需要针对这里的权限过滤进行修改即可\r\n *\r\n *  @see https://github.com/sendya/ant-design-pro-vue/pull/53\r\n */\n\nvar action = Vue.directive('action', {\n  bind: function bind(el, binding, vnode) {\n    var actionName = binding.arg;\n    var role = store.getters.role;\n    var permission = vnode.context.$route.meta.permission;\n    var actions = [];\n    role.permissions.forEach(function (p) {\n      if (p.name !== permission[0]) {\n        return;\n      }\n\n      actions = p.actionList;\n    });\n\n    if (actions.indexOf(actionName) < 0) {\n      setTimeout(function () {\n        if (el.parentNode == null) {\n          el.style.display = 'none';\n        } else {\n          el.parentNode.removeChild(el);\n        }\n      }, 10);\n    }\n  }\n});\nexport { action };",{"version":3,"sources":["E:\\ConstructionConsultationSystem\\Frontend\\src\\permission.js"],"names":["Vue","router","store","cookie","NProgress","notification","configure","showSpinner","whiteList","beforeEach","to","from","next","start","isLogin","get","path","done","getters","role","length","dispatch","then","res","roles","result","addRoutes","addRouters","redirect","decodeURIComponent","query","replace","catch","error","message","description","fullPath","includes","name","afterEach","action","directive","bind","el","binding","vnode","actionName","arg","permission","context","$route","meta","actions","permissions","forEach","p","actionList","indexOf","setTimeout","parentNode","style","display","removeChild"],"mappings":"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","sourcesContent":["import Vue from 'vue'\r\nimport router from './router'\r\nimport store from './store'\r\nimport cookie from 'js-cookie'\r\n\r\nimport NProgress from 'nprogress' // progress bar\r\nimport 'nprogress/nprogress.css' // progress bar style\r\nimport notification from 'ant-design-vue/es/notification'\r\n\r\nNProgress.configure({ showSpinner: false }) // NProgress Configuration\r\n\r\nconst whiteList = ['login'] // no redirect whitelist\r\n\r\nrouter.beforeEach((to, from, next) => {\r\n  NProgress.start() // start progress bar\r\n  const isLogin = cookie.get('sessionid')\r\n  if (isLogin) {\r\n    if (to.path === '/user/login') {\r\n      next({ path: '/project' })\r\n      NProgress.done()\r\n    } else {\r\n      if (store.getters.role.length === 0) {\r\n        store\r\n          .dispatch('GetInfo')\r\n          .then(res => {\r\n            const roles = res.result && res.result.role\r\n            store.dispatch('GenerateRoutes', { roles }).then(() => {\r\n              router.addRoutes(store.getters.addRouters)\r\n              const redirect = decodeURIComponent(from.query.redirect || to.path)\r\n              if (to.path === redirect) {\r\n                next({ ...to, replace: true })\r\n              } else {\r\n                next({ path: redirect })\r\n              }\r\n            })\r\n          })\r\n          .catch(() => {\r\n            notification.error({\r\n              message: '错误',\r\n              description: '请求用户信息失败，请重试'\r\n            })\r\n            store.dispatch('Logout').then(() => {\r\n              next({ path: '/user/login', query: { redirect: to.fullPath } })\r\n            })\r\n          })\r\n      } else {\r\n        next()\r\n      }\r\n    }\r\n  } else {\r\n    if (whiteList.includes(to.name)) {\r\n      next()\r\n    } else {\r\n      next({ path: '/user/login', query: { redirect: to.fullPath } })\r\n      NProgress.done()\r\n    }\r\n  }\r\n})\r\n\r\nrouter.afterEach(() => {\r\n  NProgress.done()\r\n})\r\n\r\n/**\r\n * Action 权限指令\r\n * 指令用法：\r\n *  - 在需要控制 name 级别权限的组件上使用 v-name:[method] , 如下：\r\n *    <i-button v-action:add >添加用户</a-button>\r\n *    <a-button v-action:delete>删除用户</a-button>\r\n *    <a v-action:edit @click=\"edit(record)\">修改</a>\r\n *\r\n *  - 当前用户没有权限时，组件上使用了该指令则会被隐藏\r\n *  - 当后台权限跟 pro 提供的模式不同时，只需要针对这里的权限过滤进行修改即可\r\n *\r\n *  @see https://github.com/sendya/ant-design-pro-vue/pull/53\r\n */\r\nconst action = Vue.directive('action', {\r\n  bind: function (el, binding, vnode) {\r\n    const actionName = binding.arg\r\n    const role = store.getters.role\r\n    const permission = vnode.context.$route.meta.permission\r\n    let actions = []\r\n    role.permissions.forEach(p => {\r\n      if (p.name !== permission[0]) {\r\n        return\r\n      }\r\n      actions = p.actionList\r\n    })\r\n    if (actions.indexOf(actionName) < 0) {\r\n      setTimeout(() => {\r\n        if (el.parentNode == null) {\r\n          el.style.display = 'none'\r\n        } else {\r\n          el.parentNode.removeChild(el)\r\n        }\r\n      }, 10)\r\n    }\r\n  }\r\n})\r\n\r\nexport {\r\n  action\r\n}\r\n"]}]}