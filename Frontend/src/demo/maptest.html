<!DOCTYPE html>
<html>
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<meta name="viewport" content="initial-scale=1.0, user-scalable=no" />
	<style type="text/css">
		body, html{width: 100%;height: 100%;margin:0;font-family:"微软雅黑";font-size:14px;}
		#l-map{height:600px;width:100%;}
		#r-result{width:100%;}
	</style>
	<script type="text/javascript" src="//api.map.baidu.com/api?v=2.0&ak=okFNZHPQ0BfF9Qhq3K1WmrRv"></script>
	<title>建筑咨询管理系统GPS定位</title>
</head>
<body>
  <div id="allmap"></div>
	<div id="l-map"></div>
	<div id="r-result">请输入查询地址:<input type="text" id="suggestId" size="20" value="百度" style="width:150px;" /></div>
	<div id="searchResultPanel" style="border:1px solid #C0C0C0;width:150px;height:auto; display:none;"></div>
  <div id="r-result">
		经度: <input id="longitude" type="text" style="width:100px; margin-right:10px;" />
		纬度: <input id="latitude" type="text" style="width:100px; margin-right:10px;" />
		<input type="button" value="查询" onclick="theLocation()" />
	</div>
  <div>
    设置点是否可拖拽：<div id="r-result">
		<input type="button" onclick="marker.enableDragging();" value="可拖拽" />
		<input type="button" onclick="marker.disableDragging();" value="不可拖拽" />
	</div>
  </div>
  <p>点击地图后显示当前经纬度</p>
  <script>
    function tz(){
     window.location.href='http://localhost:8080/#/detail/';
  }
  </script>
  <button style="float:right" onclick="tz()">返回</button>


</body>
</html>
<script type="text/javascript">
	// 百度地图API功能
	function G(id) {
		return document.getElementById(id);
	}

	var map = new BMap.Map("l-map");
	var point = new BMap.Point(116.331398,39.897445);
	map.centerAndZoom("北京",12);                   // 初始化地图,设置城市和地图级别。

	var ac = new BMap.Autocomplete(    //建立一个自动完成的对象
		{"input" : "suggestId"
		,"location" : map
	});
	ac.addEventListener("onhighlight", function(e) {  //鼠标放在下拉列表上的事件
	var str = "";
		var _value = e.fromitem.value;
		var value = "";
		if (e.fromitem.index > -1) {
			value = _value.province +  _value.city +  _value.district +  _value.street +  _value.business;
		}
		str = "FromItem<br />index = " + e.fromitem.index + "<br />value = " + value;

		value = "";
		if (e.toitem.index > -1) {
			_value = e.toitem.value;
			value = _value.province +  _value.city +  _value.district +  _value.street +  _value.business;
		}
		str += "<br />ToItem<br />index = " + e.toitem.index + "<br />value = " + value;
		G("searchResultPanel").innerHTML = str;
	});

	var myValue;
	ac.addEventListener("onconfirm", function(e) {    //鼠标点击下拉列表后的事件
	var _value = e.item.value;
		myValue = _value.province +  _value.city +  _value.district +  _value.street +  _value.business;
		G("searchResultPanel").innerHTML ="onconfirm<br />index = " + e.item.index + "<br />myValue = " + myValue;

		setPlace();
	});
	function setPlace(){
		map.clearOverlays();    //清除地图上所有覆盖物
		function myFun(){
			var pp = local.getResults().getPoi(0).point;    //获取第一个智能搜索的结果
			map.centerAndZoom(pp, 18);
			map.addOverlay(new BMap.Marker(pp));    //添加标注
		}
		var local = new BMap.LocalSearch(map, { //智能搜索
		  onSearchComplete: myFun
		});
		local.search(myValue);
	}

	map.centerAndZoom(point,11);



	//单击出经纬度
  map.centerAndZoom(new BMap.Point(116.404, 39.915), 11)

  function showInfo (e) {
    alert(e.point.lng + ', ' + e.point.lat)
  }

  map.addEventListener('click', showInfo)

  //单击创建点
  map.addEventListener("click",function(e){
		var pointN = new BMap.Point(e.point.lng,e.point.lat)
    var markerN = new BMap.Marker(pointN);
		var removeMarker = function(e,ee,marker) {
      map.removeOverlay(marker);
    }
    var markerMenu=new BMap.ContextMenu();
	markerMenu.addItem(new BMap.MenuItem('删除',removeMarker.bind(markerN)));
        map.addOverlay(markerN);
        markerN.disableDragging();
        markerN.setAnimation(BMAP_ANIMATION_BOUNCE)
        markerN.addEventListener('click', function () {
                map.removeOverlay(this);
            });
	});

  //单击创建点
  var marker = new BMap.Marker(new BMap.Point(116.331398,39.897445)); // 创建点
	marker.addEventListener("click",attribute);
	map.addOverlay(marker);    //增加点

	function attribute(){
		var p = marker.getPosition();  //获取marker的位置
		alert("marker的位置是" + p.lng + "," + p.lat);
	}
	//用经纬度设置地图中心点
	function theLocation(){
		if(document.getElementById("longitude").value != "" && document.getElementById("latitude").value != ""){
			map.clearOverlays();
			var new_point = new BMap.Point(document.getElementById("longitude").value,document.getElementById("latitude").value);
			var marker = new BMap.Marker(new_point);  // 创建标注
			map.addOverlay(marker);              // 将标注添加到地图中
			map.panTo(new_point);
		}
	}
	 var navigationControl = new BMap.NavigationControl({
        // 靠左上角位置
        anchor: BMAP_ANCHOR_TOP_LEFT,
        // LARGE类型
        type: BMAP_NAVIGATION_CONTROL_LARGE,
        // 启用显示定位
        enableGeolocation: true
    });

	  var myIcon=new BMap.Icon(style="color:#00F",new BMap.Size(90,53));
    map.addControl(navigationControl);
    var marker = new BMap.Marker(point,{icon:myIcon});  // 创建标注
	  map.addOverlay(marker);              // 将标注添加到地图中
	  map.centerAndZoom(point, 15);
	  var opts = {
	    width : 200,     // 信息窗口宽度
	    height: 100,     // 信息窗口高度
	    title : "建筑1" , // 信息窗口标题
	    enableMessage:true//设置允许信息窗发送短息
	  }
	  var infoWindow = new BMap.InfoWindow("工程规模：2" +"，" +"建筑地点：文化西路001号", opts);  // 创建信息窗口对象
	  marker.addEventListener("click", function(){
	    map.openInfoWindow(infoWindow,point); //开启信息窗口
	});
	  map.enableScrollWheelZoom();   //启用滚轮放大缩小，默认禁用
	  map.enableContinuousZoom();    //启用地图惯性拖拽，默认禁用




var menu = new BMap.ContextMenu();
	var txtMenuItem = [
		{
			text:'定位项目坐标',
			callback:function(e){
                var pointN = new BMap.Point(e.point.lng,e.point.lat)
                var markerN = new BMap.Marker(pointN);
                map.addOverlay(markerN);
                markerN.setAnimation(BMAP_ANIMATION_BOUNCE)
            }
		},
        {
			text:'放大',
			callback:function(){map.zoomIn()}
		},
		{
			text:'缩小',
			callback:function(){map.zoomOut()}
		}
	];
	for(var i=0; i < txtMenuItem.length; i++){
		menu.addItem(new BMap.MenuItem(txtMenuItem[i].text,txtMenuItem[i].callback,100));
	}

	//var options = {
		//onSearchComplete: function(results){
			// 判断状态是否正确
			//if (local.getStatus() == BMAP_STATUS_SUCCESS){
				//var s = [];
				//for (var i = 0; i < results.getProjectList(); i ++){
				//	s.push("建筑地点："+ results.getProject(i).place + ", " + results.getProject(i).longtitude);
				//}
				//document.getElementById("r-result").innerHTML = s.join("<br/>");
			//}
		//}
	//};
	//var local = new BMap.LocalSearch(map, options);
	//local.search("文化西路");

  // 城市列表
  var mp = new BMap.Map('allmap')
  var point = new BMap.Point(116.404, 39.915)
  mp.centerAndZoom(point, 14)
  mp.enableScrollWheelZoom()
  mp.enableInertialDragging()

  mp.enableContinuousZoom()

  var size = new BMap.Size(10, 20)
  mp.addControl(new BMap.CityListControl({
    anchor: BMAP_ANCHOR_TOP_LEFT,
    offset: size,
    // 切换城市之间事件
    // onChangeBefore: function(){
    //    alert('before');
    // },
    // 切换城市之后事件
    // onChangeAfter:function(){
    //   alert('after');
    // }
  }))





</script>


